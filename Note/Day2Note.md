# Day2课堂内容及自学补充
[TOC]
## Day1串讲
git复习
Arduino介绍
开发环境介绍
绘制电路图软件 FRITZING
[虚拟环境tinkercad](https://www.tinkercad.com/)，做作业用这个

## 轮询和中断
课堂上只介绍了概念，**<font color=red>中断(interrupts)</font>** 是一种硬件机制，当中断源发出中断请求时，当前程序进行存档，之后执行中断服务程序，当中断程序执行完成后，对程序进行读档，继续之前的程序，优点是使处理器的利用率显著提高，缺点是当中断过多的时候会增加CPU负载。**<font color=red>轮询(polling)</font>** 轮询是一种CPU决策如何提供周边设备服务的方式，在轮询过程中，由CPU定时发出询问，**<font color=blue>依序询问</font>** 每一个周边设备是否需要其服务。每个设备都有一个指示命令就绪的位，指示该设备的状态。当此状态就绪即给予服务，服务结束后再问下一个周边，接着不断周而复始。优点程序编写比较容易(…)，但能处理的输入输出设备的数量也是有一定限度的，程序轮询占用CPU的处理时间，效率较低。

## 项目结构
1. `setup()`: Arduino控制器 **<font color=red>通电或复位</font>**  后，即会开始执行`setup()` 函数中的程序，该部分 **<font color=red>只会执行一次</font>** 。通常我们会在`setup()` 函数中完成Arduino的初始化设置，如配置I/O口状态，初始化串口等操作。

2. `loop()`: 在`setup()` 函数中的程序执行完后，Arduino会接着执行`loop()` 函数中的程序。而`loop()`函数是一个死循环，其中的程序会不断的重复运行。通常我们会在`loop()` 函数中 **<font color=red>完成程序的主要功能</font>** ，如驱动各种模块，采集数据等。

3. `main函数`: 在进行Arduino开发时，没有像传统C/C++程序使用入口函数`main`。实际上main函数存在于Arduino核心库中，且仍然是程序的入口。(课堂上没有用到)

## 数字输入和输出
1. `pinMode(pin, mode)`： 在使用输入或输出功能前，你需要先通过`pinMode()` 函数配置引脚的模式为输入模式或输出模式。参数`pin`为指定配置的引脚编号，参数mode为指定的配置模式。通常可用模式有三种: INPUT 输入模式、OUTPUT 输出模式、INPUT_PULLUP 输入上拉模式。

2. `digitalWrite(pin, value)`： 使用`pinMode(pin, OUTPUT)`，即是把pin号引脚配置为输出模式。配置成输出模式后，需要使用`digitalWrite()` 让其输出高电平或者是低电平,使用HIGH指定输出高电平，或是使用LOW指定输出低电平。

3. `digitalRead(pin)`：同 `digitalWrite(pin, value)`，使用之前要先配置`pinMode(pin, mode)`，确定引脚为输入模式还是输出模式，返回值为获取到的信号状态，1为高电平，0为低电平。

## 时间控制`delay( ms)`
关于时间控制只讲了时间延迟`delay( ms)`，运行延时函数时，会等待指定的时间，再运行此后的程序，此函数为毫秒级延时，参数为时长，类型unsigned long。

## 串口/并口
### 什么是串口通信，是用来干什么的？
了解下通信的一些概念：
1.  **<font color=red>同步通信和异步通信</font>**   **<font color=blue>同步通信</font>** 中，通信双方按照 **<font color=blue>统一时钟节拍</font>** 工作，一般需要发送方给接收方 **<font color=red>发送信息同时发送时钟信号</font>** ，接收方根据发送方给它的时钟信号来安排自己的节奏，用在通信双方信息交换频率固定，或者经常通信时。 **<font color=blue>异步通信</font>** ，发送方需要发送信息时会 **<font color=red>首先给接收方一个信息开始的起始信号</font>** ，接收方接收到起始信号后就认为后面紧跟着的就是有效信息，才会开始注意接收信息，直到收到发送方发过来的结束标志。

2.  **<font color=red>电平信号和差分信号</font>** 电平信号和差分信号是用来描述通信线路传输方式的。也就是说如何在通信线路上表示1和0。电平信号的传输线中有一个参考电平线(一般是GND)，然后信号线上的 **<font color=blue>信号值是由信号线电平和参考电平线的电压差决定</font>** 。差分信号的传输线中没有参考电平线，所有都是信号线， **<font color=blue>1和0的表达靠信号线之间的电压差</font>** 。电平信号的2根通信线之间的电平差异容易受到干扰，传输容易失败；差分信号不容易受到干扰，因此传输质量比较稳定。现代通信一般都使用差分信号。

3.  **<font color=red>并行接口和串行接口</font>** 串行、并行主要是考虑通信线的根数，就是发送方和接收方同时可以传递的信息量的多少,例如在差分信号下，2根线(彼此差分)可以同时发送1位二进制；如果需要同时发送8位二进制就需要16根线，串行接口使用的更加广泛，因为更省信号线，而且对传输线的要求更低、成本更低，串行时可以通过提高通信速度来提高总体通信性能。

4.  **<font color=red>波特率</font>** 波特率，指的是串口通信的速率，即 **<font color=blue>串口通信时每秒钟可以传输多少个二进制位</font>** 。例如，每秒钟可以传输9600个二进制位（传输一个二进制位需要的时间是1/9600秒，也就是104us），波特率就是9600。串口通信的波特率不能随意设定，而应该是在一些值中去选择。波特率不能随意指定，主要是因为：通信双方必须事先设定相同的波特率才能成功通信，如果发送方和接收方按照不同的波特率通信则根本收不到，常用的就是9600或者115200。

5.  **<font color=red>RS232电平和TTL电平</font>** RS232电平中-15V ~ -3V表示1，+3V ~ +15V表示0；TTL电平中+5V表示1，0V表示0。

6.  **<font color=red>起始位、数据位、奇偶校验位、停止位</font>** 串口通信时，收发是一个周期一个周期进行的，每个周期传输n个二进制位。这一个周期就叫做一个通信单元， **<font color=blue>一个通信单元由：起始位+数据位+奇偶校验位+停止位组成的</font>** 。

7.  **<font color=red>单工、半双工和全双工</font>**  单工：单方向收发数据，只能A发送数据，B接收数据。半双工：双方分时收发数据，“A发送数据，B接收数据”或者“A接收数据，B发送数据”，两个方向不能同时进行。全双工：双方同时收发数据，“A发送数据，B接收数据”同时“A接收数据，B发送数据”，两个方向同时进行。

8.  **<font color=red>三根通信线：TX、RX、GND</font>** 串口线最少需要两根(GND和信号线)，可以实现单工通信；也可以使用3根通信线(TX、RX、GND)，来实现全双工通信。TX 的意思原始来于Transmit一词，意思为发送，发射，RX 的意思原始来源于Receive一词 意思为接收，收到。

### 串口相关函数
1. `begin`
    - i. `Serial.begin(speed)`，speed是指串口通信波特率
    - ii. `Serial.begin(speed, config)`，config用于数据位、校验位、停止位配置，例如`SERIAL_8N1`中，8为数据位（5、6、7、8），N为校验位（N无校验，E偶校验，O奇校验），1为停止位（1、2）。
      
2. `print`
    - i. `Serial.print(val)`, val是你要输出的数据，各种类型的数据均可
    - ii. `Serial.println(val)`, println会在输出完指定数据后，再输出一组回车换行符。
3. `read`： 调用该语句，每次都会返回一个字节的数据，这个返回值便是当前串口读取到的数据。

4. `available`： 获取串口接收到的数据个数，即获取串口接收缓冲区中的字节数。

## 其它电路相关概念自学
- **<font color=red>灌电流（sink current）</font>**：对一个端口而言，如果电流方向是向其内部流动的则是“灌电流”，比如一个IO通过一个电阻和一个LED连接至VCC，当该IO输出为逻辑0时能不能点亮LED，去查该器件手册中sink current参数。

- **<font color=red>拉电流（sourcing current）</font>**：对一个端口而言，如果电流方向是向其外部流动的则是“拉电流”，比如一个IO通过一个电阻和一个LED连至GND，当该IO输出为逻辑1时能不能点亮LED，去查该器件手册中sourcing current参数。

## 常见问题处理
1. 检查代码
2. 检查端口设置和开发板型号是否匹配
3. 检查设备管理器
4. 检查驱动

# 作业
1. 在创建的GitHub仓库中增加一个文件夹，命名为lessons2，在文件夹中增加一张图片，是设计的流水灯电路图，格式为png，在文件夹中增加led.c文件，是代码。
2. 完成串口控制双电机代码，并上传到GitHub。
3. 自学数码管使用，要求通过串口输入0-8，在数码管显示0-8
备注：两个文件都上传到lessons2,同时把笔记整合放到Note文件夹。
![数码管](https://img-blog.csdnimg.cn/2020121818152455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JlYm9ydHQ=,size_16,color_FFFFFF,t_70)